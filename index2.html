<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase接続テスト</title>
</head>
<body>
    <h1>接続テスト画面</h1>
    <p>F12キーを押して「コンソール」を見ながらボタンを押してください。</p>
    
    <!-- ボタン -->
    <button id="testBtn" style="padding: 15px; font-size: 18px; cursor: pointer;">
        Firebaseにデータを送る
    </button>

    <!-- スクリプト -->
    <script type="module">
        console.log("【開始】スクリプトが読み込まれました");

        // 1. インポート（ここが間違っているとエラーが出る）
        try {
            // jsフォルダの中のfirebase.jsを探しに行く
            var { db, collection, addDoc } = await import("./js/firebase.js");
            console.log("【成功】firebase.js が無事に見つかりました！");
        } catch (error) {
            console.error("【失敗】firebase.js が見つかりません！パスかファイル名を確認してください。", error);
            alert("【重大エラー】firebase.js が読み込めません。コンソールを見てください。");
        }

        // 2. ボタンの設定
        const btn = document.getElementById("testBtn");
        
        btn.addEventListener("click", async () => {
            console.log("【クリック】ボタンが押されました！通信を開始します...");
            
            try {
                // 3. データの送信
                const docRef = await addDoc(collection(db, "test_log"), {
                    message: "テスト成功です！",
                    timestamp: new Date()
                });
                
                console.log("【完了】データ保存成功！ ID:", docRef.id);
                alert("✅ 成功！Firebaseに保存されました！");

            } catch (e) {
                console.error("【エラー】Firebaseへの保存に失敗しました", e);
                
                // エラーの種類を判定してアドバイスを出す
                if (e.message.includes("permission-denied")) {
                    alert("❌ エラー：権限がありません（Firestoreのルールを確認）");
                } else if (e.message.includes("unauthorized-domain")) {
                    alert("❌ エラー：ドメイン許可がありません（Firebaseコンソールで承認済みドメインに追加して！）");
                } else {
                    alert("❌ エラー発生！コンソールの赤文字を見てください");
                }
            }
        });
    </script>
</body>
</html>